#!/bin/bash

# Directory where CleanShot X stores screenshots
CLEANSHOT_DIR="$HOME/Pictures/CleanShot"

# Catbox API endpoint
CATBOX_API="https://catbox.moe/user/api.php"

# Find the most recent screenshots (e.g., last 5 files)
LATEST_SCREENSHOTS=$(ls -t "$CLEANSHOT_DIR" | head -n 5)

for file in $LATEST_SCREENSHOTS; do
    FILE_PATH="$CLEANSHOT_DIR/$file"

    # Upload file to Catbox
    RESPONSE=$(curl -s -F "reqtype=fileupload" -F "userhash=YOUR_CATBOX_USERHASH" -F "file=@$FILE_PATH" "$CATBOX_API")

    if [[ $RESPONSE == http* ]]; then
        # Play subtle ding sound on success
        afplay /System/Library/Sounds/Pop.aiff
        echo "Uploaded $file: $RESPONSE"
    else
        echo "Failed to upload $file"
    fi
done
